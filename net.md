#### 三次握手四次挥手问题

三次握手为了防止连接过期请求报文延迟到达，浪费服务器资源。

四次是为了

#### P2P UDP TCP

基础：UDP/TCP有可靠特性

原因：1拥塞控制问题 2端口转发问题

## [Web协议详解与抓包实战](https://time.geekbang.org/course/intro/175)

#### 67 http2问题和3的意义

* tls多次往返问题
* 多路复用的对头阻塞问题
* 内核实现，更新缓慢
* quic：和udp一起，实现tcp、tls功能，提供http2api

#### 68 http3quic格式

* 更换IP地址和端口后，仍可复用原有连接
* udp先天没有队头阻塞问题
* 1rtt安全握手
* 0rtt恢复会话：缓存密钥

#### 97 减少小报文

* sws糊涂窗口：服务器能力不足，取出慢，窗口越来越小，报文越来越小
* 接收方david d clark算法：窗口小于某值时，通知为0
* 发送方nagle：没有未确认则立即发送，达到mss也发送
* 延迟确认：等延迟看有没有数据可与ack一起发送，若第二个数据段也来了要立刻发送
* nagle与延迟确认同时开启会导致延迟高
* tcp_cork与零拷贝

#### 98 拥塞控制：慢启动

* 字节流传输
* 丢包控制和带宽控制
* 慢启动：窗口扩充一倍
* 慢启动阈值和拥塞窗口共同决定发送窗口

#### 99 拥塞控制：拥塞避免

* 慢启动阈值，变线性。根据丢包调整阈值

#### 100 拥塞控制：快速重传与快速恢复

* 快速重传接受方：当收到失序段，发送缺口段ack号。收到后立即发送下一个期待段ack号。
* 快速重传发送方：不需要计时器，当连续收到三个相同的ack号，立刻发送该段。
* 快速重传不需要进入慢启动，而是快速恢复
* 快速恢复：重传中且正常ack未到达前启用。适当降低慢启动阈值和拥塞窗口。收到重复ack缓慢增加。收到新ack恢复。

#### 101 sack与选择重传

* 悲观与乐观重发
* 可选功能：支持选择确认中间报文段

#### 102 带宽控制

* 最佳拥塞控制点：路由器缓冲区为空且带宽为满

#### 103 基于带宽控制的bbr

* 取延迟多次的最小值，发送速度最大值。找到最佳控制点
* 通过定期逐渐提升带宽，看延迟测试是否有更大带宽可用

#### 104 四次握手关闭连接过程

#### 105 优化timewait

* 两倍报文最大生存时间MSL，必要性：再次使用连接可能被上一次数据包影响
* Linux tcp_tw_reuse：作为客户端可以使用处于tw的端口，根据timestamp拒绝迟到报文
* tcp_max_tw_bucket：限制最大tw状态数量，超出直接关闭

#### 106 keeplive 校验和 推数据

* 默认每闲置两小时查看连接应答
* push标记，说明数据告一段落
* urgent标记优先处理

#### 107 多路复用

* 非阻塞socket
* epoll：进程内缓冲区或连接状态变化的tcp连接

#### 108 四层负载均衡

#### 109 网络层和链路层

* 三层网络层：寻址，选路，打包，分片

#### 110 ipv4分类地址

#### 111 cidr无分类地址

* /n 网络地址范围，子网掩码

#### 112 arp与rarp

* 2.5层arp动态地址解析协议，广播请求，单播回答
* rarp反转
* arp欺骗

#### 113 nat技术和lvs负载均衡

* network address (port) translator

#### 114 选路协议

* RIP routing information protocol: 基于跳数选路，UDP传输
* OSPF open shortest path first: 所有路由都有相同信息，IP协议传输，网络到路由器没有开销

* BGP border gateway protocol：网络间的选路协议，内部ibgp和外部ebgp

#### 115 ip头部

