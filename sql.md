## [SQL必知必会](https://time.geekbang.org/column/intro/192)

## [MySQL实战45讲](https://time.geekbang.org/column/intro/139)

#### 1 SQL执行
连接器，查询缓存，分析器，优化器，执行器

#### 2 日志系统
先写日志再集中写入磁盘。InnoDB redolog，server层binlog。区别：特有和均可用，物理日志和原始日志，redo循环写，binlog追加写入。

更新语句的执行过程：先写redolog，再binlog，再redo提交。为了保持两份日志逻辑一致。

#### 3 事务隔离

innodb支持事务。事务间的隔离级别。实现：回滚记录。因此要避免长事务。事务的启动方式

#### 4 索引
常见：哈希表、有序数组、搜索树。哈希表适合等值查询，有序数组适合静态数据。

n叉搜索树：数据块大小。普通索引和主键索引

解决长事务技巧

5 覆盖索引：根据a值查询b值，b值在a值索引上

前缀索引：用索引开头的相符性做查询

索引下推：对索引中包含的b做判断，提前过滤，避免回表


#### 6 全局锁和表锁
全局锁：处于只读，阻塞其他。用于逻辑备份，会影响性能。innodb支持一致性读，便于备份。备份时不应使用setreadonly设置只读。

表级锁：锁表和MDL锁元数据。添加列要小心因阻塞与重试导致的死机。

#### 7 行锁
用于并发。innodb支持。用到时获得，提交了才会释放。易冲突锁要尽可能向后放，减少占用。

死锁：发现后主动回滚策略和等待超时策略。一般用主动，热点行可能带来因查找死锁带来的空转。1临时关死锁方案，一定风险，可能超时，适合确定没死锁。2并发度控制方案，客户端限，或考虑在中间件或mysqlsever层实现排队。3将热点行分为多个逻辑行。

同步不同时刻来ddl的外部表现

#### 8 事务可重复读视图细节
innodb行数据有多个版本。一致性视图时第一条快照读语句时创建的。事务有递增id。事务在一致性视图中只认id小于等于自己的版本，否则用undolog回溯。

未看懂

#### 9 普通索引和唯一索引

## 文章
#### [深入分析事务的隔离级别](http://www.hollischuang.com/archives/943)
